## Геолокация

Предназначен для геолокации при определении ближайших точек продаж к указанному адресу (по прямой).
##
Принимает от клиента два запроса:

<b>/api/shops-by-city-utterance?utterance=</b><br>
Ищет по транскрипции город и по городу количество точек продаж в нём, если только одна, возвращает её.
Если 0 или больше 1, то возвращает в ответе соотв. статусы без магазинов и rule города.

<b>/api/shops-by-rule-and-utterance?rule=...&utterance=...</b><br>
Ищет по rule город и по "город, транскрипция адреса" запрашивает у яндекса координаты абонента.
Ищет в БД ближайшие к нему магазины и возвращает их.

##
Каждые 5 минут читает почту из таблицы <b>incoming_mail_setting</b><br>
Ищет вход. сообщения с вложенным файлом, имя которого соотв. шаблону: <b>sale-addresses.*\.xlsx</b><br>
Колонки в файле:
1) город
2) адрес
3) адрес для произнесения системой
4) график работы<br>

При нахождении перемещает это письмо в папку Done, парсит файл, заливает в базу.

Для проверки состояния базы адресов и корректности добавлены след.:<br>
Посмотреть дубликаты по координатам (если дубликаты попадаются для озвучивания, то они отфильтровываются и,
в принципе, они для нас не страшны, но если заказчик поменяет, например, озвучку в одном из них, то изменений он может
не услышать, т.к. этот дубль может отфильтроваться, поэтому лучше мотивировать заказчиков устранять дубли)<br>
<b>/api/duplicate</b><br>
Посмотреть неопределившиеся координаты (широта или долгота меньше 0)<br>
<b>/api/incorrect</b><br>
Посмотреть все точки продаж<br>
<b>/api/all</b><br>
Посмотреть, какие города надо добавить в регулярки (новые населенные пункты)<br>
<b>/api/get-new-cities</b><br>

<b>Регулярки городов</b> содержатся в памяти приложения в отсортированном по убыванию длины строки названия
населённого пункта состоянии (во избежание конфликтов при определении городов с одинаковой подстрокой,
например, Орск-Пятигорск). Для добавления/изменения регулярок в памяти надо добавить/изменить их
в таблице geolocation.city_rule (на один rule одна регулярка) и выполнить пустой POST-запрос (curl, Postman, Restman и т.д.) на

<b>/api/update-cities-rules</b><br>
(возможные ошибки: неуникальный rule, ошибка в регулярном выражении)<br>
Регулярки обновляются также при запуске приложения, POST-запрос выше позволяет обновлять их без перезапуска.
